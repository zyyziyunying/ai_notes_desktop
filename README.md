# AI Notes Desktop

AI Notes Desktop 是一个面向桌面端的本地优先 Markdown 笔记应用。它以“文件夹即笔记库（vault）”为核心思路，在保持纯文本可迁移性的同时，提供结构化前言（YAML frontmatter）、双向链接与知识图谱、全文检索，以及面向 AI 的索引导出能力。

## 项目背景

- 传统笔记往往在“自由书写”和“结构化管理”之间难以兼顾；Markdown 便于书写但关系不够显式。
- 知识管理逐渐从“线性文档”转向“网络化节点”，需要更直观的关联与可视化。
- AI 能力兴起后，笔记内容如何“可被机器理解”成为新的诉求，需要稳定、可复用的索引与关系数据。

## 项目意义

- **本地优先与可迁移性**：所有笔记以 Markdown 存储在本地文件夹，避免数据锁定。
- **关系化知识结构**：通过 Wiki Link 与 frontmatter 关系，让笔记从单页走向网状结构。
- **可搜索、可视化、可集成**：内置全文检索与关系图谱，并导出 AI 索引文件，方便后续检索增强或数据处理。
- **跨平台一致体验**：基于 Flutter 桌面端能力，为多系统提供一致的使用体验。

## 设计概览

### 1 信息模型

- **NoteMeta**：id、title、path、tags、updatedAt 等基础元信息。
- **NoteDocument**：完整笔记对象（frontmatter + body）。
- **NoteLink**：统一描述“从-到”关系，支持 wikilink 与 frontmatter 关系。
- **FrontmatterLink**：可配置关系类型与备注。

### 2 数据格式与约定

- **YAML Frontmatter**（写入/补全机制）  
  如果笔记缺少 id 或 title，解析时会自动补齐并回写到文件。

  示例：

  ```yaml
  ---
  id: 4f5d-xxxx
  title: 知识节点示例
  tags: [AI, Notes]
  links:
    - to: 目标笔记
      type: relates_to
      note: 关联原因
  ---
  ```

- **Wiki Link**  
  正文中支持 `[[目标]]` 或 `[[目标|显示文本]]`，解析为笔记间的关联；也支持 `[[id:xxxx]]` 直接指向特定 id。

### 3 索引与搜索

- 使用 SQLite FTS5 构建全文检索索引。
- 索引数据库存放在应用支持目录（App Support）中，避免污染笔记库目录。
- 监听笔记库中的 .md 文件变化，自动重建索引并同步关系图。

### 4 关系与图谱

- 双向关系：同时展示出链与入链。
- 图谱可视化：使用力导向布局呈现关系网络，为性能限制默认最多展示 200 个节点。
- 关系类型可配置，保存在 `.ai/relations.json` 中。

### 5 AI 索引导出

在笔记库的 `.ai/` 目录中导出以下文件：

- `vault_index.json`：笔记元数据索引（标题、路径、标签、更新时间等）。
- `link_graph.json`：节点与边的关系图，方便知识图谱/向量化处理。
- `note_manifest.jsonl`：每行一条笔记基础信息，适合批处理与流式消费。

### 6 界面与交互

- **左侧**：笔记列表 + 搜索栏。
- **中间**：编辑区（标题与正文 Markdown）。
- **右侧**：预览 / 关联 / 图谱 三个 Tab。
- 支持新建笔记、编辑 frontmatter 关系、导出 AI 索引。

## 目录结构

- `lib/screens/`：主界面与页面组织。
- `lib/widgets/`：编辑器、预览、图谱、列表等 UI 组件。
- `lib/services/`：解析、索引、导出、关系类型管理等业务逻辑。
- `lib/models/`：数据模型定义。
- `lib/dialogs/`：关系编辑与类型管理弹窗。
- `lib/utils/`：YAML 编码等工具函数。
- `lib/theme/`：主题配置与控制器。

## 主题系统

应用内置完整的主题系统，支持深浅主题切换和多种配色方案。

### 主题模式

- **跟随系统**：自动适配系统的深浅色设置
- **浅色模式**：明亮清爽，适合白天使用
- **深色模式**：护眼，适合长时间编辑

### 配色方案

| 方案 | 说明 |
|------|------|
| 素雅中性 | 灰色调为主，低饱和度，专注内容 |
| 温暖柔和 | 米色/暖灰调，类似纸张质感 |
| 现代科技 | 蓝紫色调，有科技感 |

### 字体优化

针对不同平台优化了字体显示：

| 平台 | UI 字体 | 代码字体 |
|------|---------|----------|
| Windows | Microsoft YaHei UI | Cascadia Code, Consolas |
| macOS | PingFang SC | SF Mono, Menlo |

### 使用方式

在应用顶部工具栏：
- 点击 **调色板图标** 选择配色方案
- 点击 **亮度图标** 循环切换主题模式
